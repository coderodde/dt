#!/bin/bash

if [ ! -d "~/.dt" ]; then
  mkdir ~/.dt
fi

touch ~/.dt/table

TABLE_CONTENT="home $HOME"
SCRIPT_MAGIC=$(cat script_magic)
FUNCTION_MAGIC=$(cat function_magic)

echo "-----------"
echo -e $FUNCTION_MAGIC
echo "-----------"
echo -e $SCRIPT_MAGIC
echo "-----------"

# See whether the user has a 'home' tag.
grep -i "home" ~/.dt/table
ret=$?

if [ $ret == 0 ]; then
  echo "Initial tag 'home' already in the table."
else
  echo "Initial tag 'home' not found; appending."
  echo "$TABLE_CONTENT" >> ~/.dt/table
fi

echo -e "Writing main script '~/.dt/dt_script'..."
echo -e "$SCRIPT_MAGIC" > ~/.dt/dt_script
echo -e "Writing main script done!"

grep "function dt" ~/.bashrc
ret=$?

if [ $ret == 0 ]; then
  echo "Function magic already in .bashrc"
else
  echo -e "Writing function magic to .bashrc.\nPlease reload by typing '. ~/.bashrc'"
  echo -e "$FUNCTION_MAGIC" >> ~/.bashrc
fi

grep "function dt" ~/.bash_profile
ret=$?

if [ $ret == 0 ]; then
  echo "Function magic already in .bash_profile"
else
  echo -e "Writing function magic to .bash_profile."
  echo -e "$FUNCTION_MAGIC" >> ~/.bash_profile
fi

gcc dt_engine.c -o ~/.dt/dt_engine
echo -e "dt_engine compiled.\nInstallation succeeded!"
